// Proto schema formatted by Wire, do not edit.
// Source: SVR2.proto

syntax = "proto3";

option java_multiple_files = true;
option java_package = "org.signal.svr2.proto";

message Request {
  // backupId, only used by server
  reserved 1;

  oneof inner {
    BackupRequest backup = 2;
    ExposeRequest expose = 5;
    RestoreRequest restore = 3;
    DeleteRequest delete = 4;
  }
}

message Response {
  oneof inner {
    BackupResponse backup = 1;
    ExposeResponse expose = 4;
    RestoreResponse restore = 2;
    DeleteResponse delete = 3;
  }
}

// 
// backup
// 
message BackupRequest {
  // between 16 and 48 bytes
  bytes data = 1;

  // 32 bytes
  bytes pin = 2;

  // in range [1,255]
  uint32 maxTries = 3;
}

message BackupResponse {
  Status status = 1;

  enum Status {
    // never returned
    UNSET = 0;
    // successfully set db[backup_id]=data
    OK = 1;
    // the request was not correctly specified
    REQUEST_INVALID = 2;
  }
}

// 
// restore
// 
message RestoreRequest {
  // 32 bytes
  bytes pin = 1;
}

message RestoreResponse {
  Status status = 1;

  // between 16 and 48 bytes, if set
  bytes data = 2;

  // in range [0,255]
  uint32 tries = 3;

  enum Status {
    // never returned
    UNSET = 0;
    // successfully restored, [data] will be set
    OK = 1;
    // db[backup_id] does not exist
    MISSING = 2;
    // pin did not match, tries were decremented
    PIN_MISMATCH = 3;
    // the request was not correctly specified, tries were not decremented
    REQUEST_INVALID = 4;
  }
}

// 
// delete
// 
message DeleteRequest {}

message DeleteResponse {}

message ExposeRequest {
  bytes data = 1;
}

// 
// expose
// 
message ExposeResponse {
  Status status = 1;

  enum Status {
    // never returned
    UNSET = 0;
    // successfully restored, [data] will be set
    OK = 1;
    // If this status comes back after a successful Backup() call,
    // this should be cause for concern.
    // It means that someone has either reset, deleted, or tried to brute-force
    // the backup since it was created.
    ERROR = 2;
  }
}
